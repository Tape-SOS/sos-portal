<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Reporte SOS</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root{--fg:#111;--bg:#fff;--accent:#277771;--muted:#666;--error:#b00020;--ok:#0a7d2f}
    @media (prefers-color-scheme: dark){
      :root{--fg:#eee;--bg:#111;--muted:#aaa}
      input,select,button,textarea{background:#1b1b1b;color:var(--fg);border-color:#333}
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;background:var(--bg);color:var(--fg);max-width:640px;margin:24px auto;padding:0 16px;line-height:1.35}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin:14px 0}
    .lang-switch{display:flex;gap:6px;flex-wrap:wrap}
    .lang-btn{display:flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #e0e0e0;border-radius:999px;background:#fff;cursor:pointer;font-size:.9rem}
    .lang-btn.active{border-color:var(--accent)}
    .flag{font-size:1.1rem;line-height:1}
    h1{font-size:1.4rem;margin:.5rem 0 1rem}
    form{border:1px solid #e6e6e6;border-radius:12px;padding:16px}
    label{display:block;margin:10px 0 6px;font-weight:600}
    .req::after{content:" *";color:var(--accent);font-weight:700}
    input,select,button,textarea{width:100%;padding:12px;border:1px solid #d7d7d7;border-radius:10px;outline:none}
    input:focus,select:focus,textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px color-mix(in oklab, var(--accent) 25%, transparent)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .row-tel{display:grid;grid-template-columns:minmax(120px,160px) 1fr;gap:10px}
    .hint{font-size:.85rem;color:var(--muted);margin-top:4px}
    .actions{display:flex;gap:10px;align-items:center;margin-top:8px}
    .actions button{flex:1}
    .ghost{background:transparent;border-style:dashed}
    .badge{display:inline-block;font-size:.78rem;padding:4px 8px;border-radius:999px;border:1px solid #e6e6e6;color:var(--muted)}
    #msg{margin-top:14px;font-weight:600}
    .ok{color:var(--ok)}
    .err{color:var(--error)}
    .muted{color:var(--muted)}
    .maplink{margin-top:6px;display:inline-block}
    .sr-only{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
    .footer{margin-top:14px;font-size:.85rem;color:var(--muted)}
    .spinner{inline-size:1em;block-size:1em;border:.18em solid #ccc;border-right-color:transparent;border-radius:50%;display:inline-block;vertical-align:-.2em;animation:s 0.8s linear infinite}
    @keyframes s{to{transform:rotate(1turn)}}

    /* Barra de √≠conos sociales */
    .social {
      margin-top: 12px;
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .social a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: rgba(0, 102, 0, 1);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid #e0e0e0;
      text-decoration: none;
    }
    .social a:hover { box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent) 25%, transparent); }
    .social svg { width: 22px; height: 22px; }
    @media (prefers-color-scheme: dark){
      .social a { background:#1b1b1b; border-color:#333; }
    }

    /* Aviso legal peque√±o */
    .legal{
      margin-top: 12px;
      font-size: .78rem;
      color: var(--muted);
      line-height: 1.35;
    }

    /* Logo centrado arriba (nuevo) */
    .logo-top{
      text-align:center;
      margin: 4px 0 10px;
    }
    .logo-top svg,
    .logo-top img{
      height:72px;
      width:auto;
      display:inline-block;
    }
    @media (max-width:480px){
      .logo-top svg, .logo-top img{ height:60px; }
    }
  </style>
</head>
<body>
  <!-- Logo centrado arriba -->
  <div class="logo-top" aria-label="Tape Pora S.A.">
<?xml version="1.0" encoding="UTF-8"?>
<svg id="Capa_1" data-name="Capa 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 945.87 305.44">
  <defs>
    <style>
      .cls-1 {
        fill: #000000;
      }

      .cls-2 {
        fill: #000000;
      }

      .cls-3 {
        fill: #fff;
      }

      .cls-4 {
        fill: #000000;
      }

      .cls-5 {
        fill: #000000;
      }

      .cls-6 {
        fill: #fff;
      }

      .cls-7 {
        fill: #000000;
      }

      .cls-8 {
        fill: #fff;
      }

      .cls-9 {
        fill: #fff;
      }

      .cls-10 {
        fill: #000000;
      }

      .cls-11 {
        fill: #fff;
      }

      .cls-12 {
        fill: #000000;
      }

      .cls-13 {
        fill: #017a41;
      }

      .cls-14 {
        fill: #000000;
      }

      .cls-15 {
        fill: #000000;
      }

      .cls-16 {
        fill: #000000;
      }

      .cls-17 {
        fill: #fff;
      }

      .cls-18 {
        fill: #fff;
      }

      .cls-19 {
        fill: #017a41;
      }

      .cls-20 {
        fill: #fff;
      }

      .cls-21 {
        fill: #017a41;
      }

      .cls-22 {
        fill: #fff;
      }
    </style>
  </defs>
  <path class="cls-3" d="M945.87,0v305.44H0V0h945.87ZM903.98,76.27l-15.6-8.33c-1.54-.22-2.79,2.34-4.55,3.13-6.52,2.91-13.76-2.76-20.07-3.57-10.39-1.33-20.79,4.41-24.29,14.32l15.06,10.6c9.25-13.22,21.43.64,33.48-.46,7.41-.67,14.26-8.86,15.97-15.69ZM356.48,135.26c-.08-13.34-8.2-25.81-20.55-30.87-8.94-3.67-25.26-2.94-35.31-3.09-10.26-.16-20.54.17-30.8.02l-2.46,33.94h31.51l.46-6.67c8.29.54,23.76-3.59,27.11,6.67h30.04ZM375.69,135.75h30.53v-6.39h51.95l.74-1.23.99-26.32-82.23-.49-1.97,34.43ZM138.85,127.88l1.95-24.39-.79-1.11c-33.58.11-67.08-.37-100.62-.57l-1.97,26.07h34.47l-.49,7.87h32.5l.98-7.87h33.97ZM508.63,209.53h29.3l2.21-30.5c15.38-.06,29.81,1.95,42.35-8.6,24.87-20.92,19.02-63.52-15.5-68.15l-52.41-.42-5.96,107.66ZM657.23,101.96c-34.67,3.09-50.29,32.27-48.18,64.55,3.76,57.44,87.21,58.36,99.83,4.26,8.64-37.06-10.06-72.52-51.65-68.81ZM165.44,136.24h31.51l2.71-7.87,1.72,7.87h31.02l-7.9-33.42-45.79-.29-13.27,33.71ZM725.77,210.02h28.07l1.48-36.89h9.6l16,36.4h32l-20.22-41.53c24.19-15.16,20.73-56.11-9.71-61.13-15.91-2.62-35.27.68-51.59-.65l-1.24.24-4.4,103.57ZM913.86,209.04l-23.87-100.84-38.18-.73-31.99,102.55,27.52-.54,6.75-20.64,27.46.09,6.2,20.37,26.12-.27ZM298.38,137.23h-31.02l-.98,16.23h7.88l-.49,3.44h-7.88l-.98,15.74h71.15c6.06-3.98,11.69-9.18,15.02-15.74h-11.82l1.3-3.38c2.16-.51,11.74.66,12.74-.55.33-.4,1.84-5.37,2.06-6.3.71-3.02,1.12-6.34,1.13-9.44h-29.54c.57,4.59-.79,8.69-4.85,11.14-.53.32-3.47,1.65-3.76,1.65h-20.43l.49-12.79ZM103.89,137.72h-32.99l-.99,16.23c3.17.15,6.87-1.26,3.95,3.2l-4.44.24-.98,15.74h32.99l.99-15.74-5.92-.25,1.06-3.12,5.35-.06.98-16.23ZM405.72,137.72h-30.04l-1.97,35.41h30.04l.49-6.39h40.87l.49-10.82h-11.08l-.62-.72.37-2.73h11.82l.49-10.33h-40.87v-4.43ZM236.34,154.44c-1.27-5.36-2.35-10.83-3.45-16.23h-31.02l3.69,16.23h16.49c-.04,1.2.37,2.65-.74,3.44h-15.51l.98,3.44h-18.71l.98-3.44-2.45-.24c.97-2.84,1.28-3.03,4.19-3.68l5.16-15.75h-31.51l-5.91,16.23h12.8l-.82,3.46-13.4.04-5.47,15.68h89.12c-1.2-6.08-2.53-12.17-3.94-18.2-.11-.46-.45-.81-.49-.98ZM333.84,174.61h-68.93l-2.46,34.43h31.51l1.97-30h25.85c1.13,0,5.26-1.29,6.63-1.74l5.44-2.69ZM100.94,175.1h-32.99l-2.46,33.94h32.99l2.46-33.94ZM403.75,175.1h-30.53l-1.97,34.43,82.72-.49,1.48-27.55h-52.19l.49-6.39ZM137.37,209.53h32.5l8.86-20.42c11.02-.28,21.98-1.23,33.03-.52l5.88,20.44h31.51l-7.93-33.4-90.06.19-13.78,33.7ZM320.05,228.22c.44-3.35-2.88-3.41-2.47,0h2.47ZM661.27,228.22c.44-3.35-2.88-3.41-2.47,0h2.47ZM349.1,226.25h-2.46s0,6.39,0,6.39c-1.44-.31-2.57-1.42-4.19-1.39-8.75.15-5.83,20.74,3.95,13.2l.25,1.47,2.45-.73v-18.94ZM611.54,226.25h-1.96v1.96h1.96v-1.96ZM511.59,242.24c-.44-2.48.32-5.99,0-8.61h2.96s0-1.72,0-1.72l-2.96-.25v-3.94s-1.96,0-1.96,0l.03,3.67-1.44.32-.08,1.68,1.52.51c.87,4.37-2.83,13.01,4.89,12.02.79-3.3-2.58-1.58-2.96-3.69ZM266.77,231.27c-5.98.46-7.19,7.53-4.93,12.05,2.13,4.27,11.23,2.76,10.44-.1-.5-1.81-3.58.77-5.12.7-4.04-.17-4.35-4.86-3.63-7.98s5.43-2.84,7.46-.87l1.26-1.63c-1.05-1.59-3.67-2.31-5.49-2.17ZM377.17,245.93v-10.57c0-4.18-8.47-5.48-10.82-1.97,1.42,2.16,2.32.4,4.17.22,2.82-.27,4.47.4,4.19,3.47-3.62,0-8.76-.67-8.91,4.18-.2,6.83,7.24,3.74,11.37,4.68ZM414.09,245.93v-11.07c0-1.54-2.73-3.44-4.3-3.58-2.93-.26-4.53,2.34-4.81,2.34-.33,0-1.8-2.89-5.18-2.25-.98.18-2.29,1.21-2.71,1.28-.16.03-.59-1.82-2.7-.99v13.53l2.46.74v-10.57c0-2.07,6.4-2.6,6.4.49v10.08l2.39-.81c.51-2.21-.69-9.52.68-10.88.82-.82,3.52-.79,4.48-.16.27.18,1.31,2.59,1.31,2.75v9.1h1.97ZM441.5,232.81c-3.05-2.98-9.42-1.61-10.14,3.06-.91,5.88.85,11.53,7.88,9.84,4.68-1.13,5.15-10.07,2.26-12.9ZM470.72,232.65c-3.93-2.48-12.58-1.72-10.73,4.56,1.07,3.64,9.66.96,9.27,4.51-.69,2.34-3.56,2.56-5.58,2.12-1.72-.38-3.53-2.91-4.29.6,3.39,1.92,11.65,2.85,11.86-2.69s-5.24-3.76-8.8-4.78c-2.09-4.25,4.56-3.93,7.03-2.5l1.22-1.82ZM640.1,245.93v-11.56c0-1.75-4.38-3.22-6.01-3.09-.89.07-5.33,1.55-4.32,2.84.79,1.02,2.87-.34,3.72-.46,2.86-.4,4.55.36,4.65,3.42-3.39-.13-9.19-.43-9.39,4.19s5.95,6.01,9.15,3.68l.55.99h1.66ZM689.83,239.53c1.16-5.65-3.11-10.33-8.64-7.4-4.27,2.27-4.24,12.97,2.04,13.75,2.05.26,8.01-.73,5.34-3.4-3.78,1.92-7.82,2.38-8.1-2.96h9.36ZM291,231.66h-2.46v10.57c0,.14,1.22,2.2,1.47,2.47,2.1,2.24,5.65,1.22,7.88-.26l.05,1.42,1.92.06v-14.26h-1.97v9.1c0,4.06-6.89,3.55-6.89,1.48v-10.57ZM320.05,231.66h-2.46v13.53l.8.67,1.66.07v-14.26ZM543.1,231.66l-2.39.81c-.28,4.89,1.75,15.33-6.23,10.01l-.31-10.01-2.39-.81v10.57c0,1.04,1.83,3.13,2.93,3.47,2.89.89,3.66-.52,5.28-.67.7-.06,1.92,1.4,3.12.89v-14.26ZM586.91,241.99c-.84.66-3.69-9.25-4.18-9.84-.6-.72-1.43-.49-2.21-.49-.47.44,3.7,10.84,4.34,12.13.85,1.7,1.68,3.53,3.07.92,2.02-3.79,3.27-9.01,4.9-13.06l-2.4.06-3.51,10.27ZM611.54,231.66h-1.97v14.26c.57.2,1.97-.22,1.97-.74v-13.53ZM661.27,231.66h-2.46v16.97l-2.96.74v1.96c1.48.42,5.42-.32,5.42-2.21v-17.46Z"/>
  <path class="cls-13" d="M657.23,101.96c41.59-3.7,60.3,31.75,51.65,68.81-12.62,54.1-96.07,53.18-99.83-4.26-2.11-32.28,13.5-61.46,48.18-64.55ZM657.2,127.51c-22.15,3.44-25.12,67.07,7.91,57.08,15.16-4.58,16.68-30.89,13.14-43.43-3.03-10.74-9.7-15.42-21.05-13.66Z"/>
  <path class="cls-13" d="M725.77,210.02l4.4-103.57,1.24-.24c16.31,1.33,35.68-1.97,51.59.65,30.43,5.02,33.9,45.98,9.71,61.13l20.22,41.53h-32l-16-36.4h-9.6l-1.48,36.89h-28.07ZM756.3,150.01h17.48c4.62,0,8.17-6.41,8.16-10.57s-3.96-9.59-8.16-9.59h-16.99l-.49,20.17Z"/>
  <path class="cls-13" d="M508.63,209.53l5.96-107.66,52.41.42c34.52,4.62,40.36,47.22,15.5,68.15-12.54,10.55-26.97,8.54-42.35,8.6l-2.21,30.5h-29.3ZM541.62,151h18.46c1.62,0,5.13-1.79,6.41-2.94,4.92-4.38,4.12-13.38-1.56-16.66-.52-.3-4.02-1.55-4.36-1.55h-17.97l-.98,21.15Z"/>
  <path class="cls-21" d="M913.86,209.04l-26.12.27-6.2-20.37-27.46-.09-6.75,20.64-27.52.54,31.99-102.55,38.18.73,23.87,100.84ZM876.93,163.79l-7.38-30.49-8.38,30.49h15.76Z"/>
  <path class="cls-10" d="M138.85,127.88h-33.97l-.98,7.87h-32.5l.49-7.87h-34.47l1.97-26.07c33.54.2,67.04.68,100.62.57l.79,1.11-1.95,24.39Z"/>
  <path class="cls-5" d="M137.37,209.53l13.78-33.7,90.06-.19,7.93,33.4h-31.51l-5.88-20.44c-11.04-.71-22,.23-33.03.52l-8.86,20.42h-32.5Z"/>
  <path class="cls-10" d="M356.48,135.26h-30.04c-3.36-10.26-18.82-6.13-27.11-6.67l-.46,6.67h-31.51l2.46-33.94c10.26.15,20.54-.18,30.8-.02,10.05.15,26.37-.57,35.31,3.09,12.35,5.06,20.47,17.53,20.55,30.87Z"/>
  <polygon class="cls-2" points="403.75 175.1 403.26 181.49 455.45 181.49 453.98 209.04 371.25 209.53 373.23 175.1 403.75 175.1"/>
  <polygon class="cls-10" points="375.69 135.75 377.65 101.32 459.89 101.81 458.9 128.13 458.16 129.36 406.22 129.36 406.22 135.75 375.69 135.75"/>
  <path class="cls-5" d="M298.38,137.23l-.49,12.79h20.43c.29,0,3.24-1.33,3.76-1.65,4.07-2.45,5.42-6.55,4.85-11.14h29.54c-.01,3.11-.42,6.43-1.13,9.44-.22.93-1.73,5.9-2.06,6.3-1.01,1.21-10.58.04-12.74.55l-1.3,3.38h11.82c-3.32,6.56-8.95,11.76-15.02,15.74h-71.15l.98-15.74h7.88l.49-3.44h-7.88l.98-16.23h31.02ZM302.32,153.46h-16.25l-.98,3.44h16l1.23-3.44ZM316.6,153.46h-7.39l-.98,3.44h7.14c.89-.88,1.22-2.22,1.23-3.44ZM336.3,153.46h-15.26l-.49,3.44h14.77l.98-3.44Z"/>
  <path class="cls-1" d="M236.84,155.43c1.41,6.03,2.74,12.12,3.94,18.2h-89.12l5.47-15.68,13.4-.04.82-3.46h-12.8l5.91-16.23h31.51l-5.16,15.75c-2.91.65-3.22.84-4.19,3.68l2.45.24-.98,3.44h18.71l-.98-3.44h15.51c1.11-.8.7-2.25.74-3.44h-16.49l-3.69-16.23h31.02c1.09,5.4,2.18,10.87,3.45,16.23-3.45.43-8.82-1.81-8.37,3.44l7.06.02,1.8-2.48ZM184.15,154.44h-7.14c-.89.88-1.22,2.22-1.23,3.44h7.39l.98-3.44Z"/>
  <path class="cls-16" d="M405.72,137.72v4.43h40.87l-.49,10.33h-11.82l-.37,2.73.62.72h11.08l-.49,10.82h-40.87l-.49,6.39h-30.04l1.97-35.41h30.04ZM391.44,152.47h-7.39l-.98,3.44h7.88l.49-3.44ZM410.15,152.47h-14.53c-.89.88-1.22,2.22-1.23,3.44h14.77l.98-3.44ZM429.85,152.47h-15.51c-.89.88-1.22,2.22-1.23,3.44h16.25l.49-3.44Z"/>
  <polygon class="cls-10" points="165.44 136.24 178.72 102.53 224.5 102.82 232.4 136.24 201.38 136.24 199.66 128.37 196.95 136.24 165.44 136.24"/>
  <path class="cls-5" d="M333.84,174.61l-5.44,2.69c-1.37.45-5.49,1.74-6.63,1.74h-25.85l-1.97,30h-31.51l2.46-34.43h68.93Z"/>
  <polygon class="cls-10" points="100.94 175.1 98.48 209.04 65.49 209.04 67.95 175.1 100.94 175.1"/>
  <path class="cls-19" d="M903.98,76.27c-1.72,6.83-8.56,15.02-15.97,15.69-12.05,1.09-24.22-12.76-33.48.46l-15.06-10.6c3.5-9.9,13.9-15.65,24.29-14.32,6.32.81,13.55,6.47,20.07,3.57,1.77-.79,3.01-3.35,4.55-3.13l15.6,8.33Z"/>
  <path class="cls-15" d="M103.89,137.72l-.98,16.23-5.35.06-1.06,3.12,5.92.25-.99,15.74h-32.99l.98-15.74,4.44-.24c2.92-4.46-.77-3.05-3.95-3.2l.99-16.23h32.99ZM93.55,153.95h-14.53c-.89.88-1.22,2.22-1.23,3.44h14.77l.98-3.44Z"/>
  <path class="cls-12" d="M414.09,245.93h-1.97v-9.1c0-.15-1.04-2.57-1.31-2.75-.96-.63-3.66-.66-4.48.16-1.37,1.36-.17,8.67-.68,10.88l-2.39.81v-10.08c0-3.09-6.4-2.56-6.4-.49v10.57l-2.46-.74v-13.53c2.11-.83,2.54,1.01,2.7.99.42-.07,1.73-1.1,2.71-1.28,3.38-.64,4.85,2.25,5.18,2.25.28,0,1.88-2.6,4.81-2.34,1.57.14,4.3,2.04,4.3,3.58v11.07Z"/>
  <path class="cls-12" d="M349.1,226.25v18.94l-2.45.73-.25-1.47c-9.78,7.53-12.71-13.05-3.95-13.2,1.62-.03,2.75,1.09,4.19,1.39v-6.39s2.46,0,2.46,0ZM342.57,233.21c-3.88.7-4.82,11.5,1.31,10.73,4.4-.55,4.04-11.7-1.31-10.73Z"/>
  <path class="cls-12" d="M377.17,245.93c-4.12-.94-11.57,2.16-11.37-4.68.14-4.85,5.28-4.17,8.91-4.18.28-3.07-1.37-3.74-4.19-3.47-1.86.18-2.76,1.95-4.17-.22,2.36-3.51,10.82-2.22,10.82,1.97v10.57ZM368.43,239.65c-.49.42-.73,1.84-.55,2.48.81,2.33,6.55,2.52,7.24.51.25-.73.29-2.93-.38-3.39-.77-.54-5.57-.23-6.31.4Z"/>
  <path class="cls-4" d="M640.1,245.93h-1.66s-.55-.99-.55-.99c-3.21,2.34-9.35,1-9.15-3.68s5.99-4.32,9.39-4.19c-.1-3.06-1.79-3.82-4.65-3.42-.85.12-2.93,1.48-3.72.46-1.01-1.3,3.43-2.77,4.32-2.84,1.64-.13,6.01,1.34,6.01,3.09v11.56ZM638.13,239.04c-10.42-2.12-8,7.77-1.1,4.56,1.77-.83.96-2.91,1.1-4.56Z"/>
  <path class="cls-14" d="M689.83,239.53h-9.36c.27,5.34,4.32,4.87,8.1,2.96,2.67,2.66-3.29,3.65-5.34,3.4-6.28-.78-6.31-11.49-2.04-13.75,5.53-2.93,9.79,1.75,8.64,7.4ZM687.86,237.56c.4-5.8-7.71-5.48-7.39,0h7.39Z"/>
  <path class="cls-7" d="M441.5,232.81c2.89,2.83,2.42,11.77-2.26,12.9-7.03,1.69-8.79-3.96-7.88-9.84.72-4.67,7.09-6.04,10.14-3.06ZM440.06,242.85c1.14-1.21,1.33-8.37-1.2-9.11-7.22-2.12-7.28,10.29-1.87,10.25.67,0,2.66-.7,3.07-1.14Z"/>
  <path class="cls-7" d="M543.1,231.66v14.26c-1.2.51-2.41-.96-3.12-.89-1.62.15-2.39,1.57-5.28.67-1.09-.34-2.93-2.42-2.93-3.47v-10.57l2.39.81.31,10.01c7.98,5.32,5.94-5.13,6.23-10.01l2.39-.81Z"/>
  <path class="cls-7" d="M470.72,232.65l-1.22,1.82c-2.48-1.43-9.13-1.75-7.03,2.5,3.56,1.03,9.01-.52,8.8,4.78s-8.48,4.61-11.86,2.69c.77-3.51,2.58-.97,4.29-.6,2.02.44,4.89.22,5.58-2.12.38-3.56-8.2-.87-9.27-4.51-1.85-6.28,6.79-7.04,10.73-4.56Z"/>
  <path class="cls-12" d="M291,231.66v10.57c0,2.08,6.89,2.58,6.89-1.48v-9.1h1.97v14.26l-1.92-.06-.05-1.42c-2.23,1.48-5.79,2.5-7.88.26-.25-.27-1.47-2.33-1.47-2.47v-10.57h2.46Z"/>
  <path class="cls-12" d="M266.77,231.27c1.82-.14,4.44.58,5.49,2.17l-1.26,1.63c-2.04-1.97-6.71-2.38-7.46.87s-.41,7.81,3.63,7.98c1.54.07,4.62-2.51,5.12-.7.79,2.86-8.31,4.37-10.44.1-2.26-4.52-1.05-11.59,4.93-12.05Z"/>
  <path class="cls-7" d="M586.91,241.99l3.51-10.27,2.4-.06c-1.62,4.05-2.88,9.26-4.9,13.06-1.39,2.61-2.22.78-3.07-.92-.65-1.29-4.81-11.69-4.34-12.13.78,0,1.62-.23,2.21.49.48.58,3.34,10.49,4.18,9.84Z"/>
  <path class="cls-7" d="M661.27,231.66v17.46c0,1.89-3.94,2.63-5.42,2.21v-1.96s2.96-.74,2.96-.74v-16.97h2.46Z"/>
  <path class="cls-12" d="M511.59,242.24c.37,2.1,3.74.38,2.96,3.69-7.72.99-4.02-7.65-4.89-12.02l-1.52-.51.08-1.68,1.44-.32-.03-3.67h1.96s0,3.94,0,3.94l2.96.25v1.72s-2.96,0-2.96,0c.32,2.61-.44,6.13,0,8.61Z"/>
  <polygon class="cls-7" points="320.05 231.66 320.05 245.93 318.39 245.86 317.59 245.19 317.59 231.66 320.05 231.66"/>
  <path class="cls-12" d="M611.54,231.66v13.53c0,.52-1.4.94-1.97.74v-14.26h1.97Z"/>
  <path class="cls-17" d="M236.34,154.44c.04.17.39.52.49.98l-1.8,2.48-7.06-.02c-.45-5.26,4.92-3.01,8.37-3.44Z"/>
  <path class="cls-7" d="M320.05,228.22h-2.47c-.42-3.41,2.9-3.35,2.47,0Z"/>
  <path class="cls-7" d="M661.27,228.22h-2.47c-.42-3.41,2.9-3.35,2.47,0Z"/>
  <rect class="cls-7" x="609.57" y="226.25" width="1.96" height="1.96"/>
  <path class="cls-20" d="M657.2,127.51c11.34-1.76,18.02,2.92,21.05,13.66,3.54,12.54,2.02,38.84-13.14,43.43-33.02,9.98-30.06-53.64-7.91-57.08Z"/>
  <path class="cls-6" d="M756.3,150.01l.49-20.17h16.99c4.2,0,8.15,5.55,8.16,9.59s-3.54,10.57-8.16,10.57h-17.48Z"/>
  <path class="cls-11" d="M541.62,151l.98-21.15h17.97c.34,0,3.84,1.25,4.36,1.55,5.68,3.28,6.49,12.29,1.56,16.66-1.29,1.15-4.8,2.94-6.41,2.94h-18.46Z"/>
  <polygon class="cls-22" points="876.93 163.79 861.18 163.79 869.55 133.29 876.93 163.79"/>
  <polygon class="cls-8" points="302.32 153.46 301.09 156.9 285.09 156.9 286.07 153.46 302.32 153.46"/>
  <polygon class="cls-8" points="336.3 153.46 335.31 156.9 320.54 156.9 321.03 153.46 336.3 153.46"/>
  <path class="cls-17" d="M316.6,153.46c-.01,1.23-.34,2.56-1.23,3.44h-7.14l.98-3.44h7.39Z"/>
  <path class="cls-17" d="M184.15,154.44l-.98,3.44h-7.39c.01-1.23.34-2.56,1.23-3.44h7.14Z"/>
  <path class="cls-9" d="M429.85,152.47l-.49,3.44h-16.25c.01-1.23.34-2.56,1.23-3.44h15.51Z"/>
  <path class="cls-9" d="M410.15,152.47l-.98,3.44h-14.77c.01-1.23.34-2.56,1.23-3.44h14.53Z"/>
  <polygon class="cls-9" points="391.44 152.47 390.95 155.92 383.07 155.92 384.06 152.47 391.44 152.47"/>
  <path class="cls-8" d="M93.55,153.95l-.98,3.44h-14.77c.01-1.23.34-2.56,1.23-3.44h14.53Z"/>
  <path class="cls-11" d="M342.57,233.21c5.35-.96,5.71,10.18,1.31,10.73-6.13.77-5.19-10.03-1.31-10.73Z"/>
  <path class="cls-18" d="M368.43,239.65c.73-.63,5.53-.94,6.31-.4.67.47.63,2.66.38,3.39-.69,2-6.43,1.81-7.24-.51-.18-.65.07-2.06.55-2.48Z"/>
  <path class="cls-8" d="M638.13,239.04c-.14,1.65.67,3.73-1.1,4.56-6.9,3.21-9.32-6.67,1.1-4.56Z"/>
  <path class="cls-22" d="M687.86,237.56h-7.39c-.32-5.48,7.79-5.8,7.39,0Z"/>
  <path class="cls-22" d="M440.06,242.85c-.42.44-2.4,1.13-3.07,1.14-5.41.04-5.36-12.37,1.87-10.25,2.54.74,2.34,7.9,1.2,9.11Z"/>
</svg>
  </div>

  <!-- Tu header original intacto -->
  <header>
    <div>
      <h1 id="t_title">Reportar evento SOS</h1>
      <p class="hint" id="t_intro">Comparte tu ubicaci√≥n para enviar ayuda m√°s r√°pido. Tus datos se usar√°n solo para gestionar este reporte.</p>
    </div>
    <nav class="lang-switch" aria-label="Idioma / Language">
      <button class="lang-btn" data-lang="es" title="Espa√±ol"><span class="flag">üá™üá∏</span><span>Espa√±ol</span></button>
      <button class="lang-btn" data-lang="en" title="English"><span class="flag">üá∫üá∏</span><span>English</span></button>
      <button class="lang-btn" data-lang="pt" title="Portugu√™s"><span class="flag">üáßüá∑</span><span>Portugu√™s</span></button>
      <button class="lang-btn" data-lang="gn" title="Ava√±e'·∫Ω (Guaran√≠)"><span class="flag">üáµüáæ</span><span>Guaran√≠</span></button>
      <button class="lang-btn" data-lang="de" title="Deutsch"><span class="flag">üá©üá™</span><span>Deutsch</span></button>
    </nav>
  </header>


  <form id="f" novalidate aria-describedby="formHint">
    <div class="sr-only" id="formHint">Todos los campos marcados con * son obligatorios.</div>

    <label for="nombre" id="lbl_nombre">Nombre</label>
    <input id="nombre" name="nombre" placeholder="Tu nombre" autocomplete="name" inputmode="text" maxlength="80"/>

    <label class="req" id="lbl_tel">Tel√©fono</label>
    <div class="row-tel">
      <select id="codPais" name="codPais" aria-label="C√≥digo de pa√≠s">
        <option value="+595" selected>PY (+595)</option>
        <option value="+55">BR (+55)</option>
        <option value="+54">AR (+54)</option>
        <option value="+598">UY (+598)</option>
        <option value="+591">BO (+591)</option>
      </select>
      <input id="telefono" name="telefono" type="tel" placeholder="981 123 456" autocomplete="tel"
             required pattern="^\d{6,11}$" aria-describedby="telHint">
    </div>
    <div class="hint" id="telHint">
      Escribe solo el n√∫mero local (sin 0, sin +). Se marcar√° como <code id="phonePreview">+595 981 123 456</code>.
    </div>

    <label for="tipo" class="req" id="lbl_tipo">Tipo de evento</label>
    <select id="tipo" name="tipo" required>
      <option value="">Selecciona‚Ä¶</option>
      <option value="Accidente">Accidente</option>
      <option value="Mecanico">Problema mec√°nico</option>
      <option value="Otro">Otro</option>
    </select>

    <!-- Campo condicional: ¬øHay heridos? -->
    <div id="grupoHeridos" hidden>
      <label for="heridos" class="req" id="lbl_heridos">¬øHay heridos?</label>
      <select id="heridos" name="heridos" aria-live="polite">
        <option value="">Selecciona‚Ä¶</option>
        <option value="si">Si</option>
        <option value="no">No</option>
      </select>
    </div>

    <label for="detalle" id="lbl_detalle">Detalle (opcional)</label>
    <textarea id="detalle" name="detalle" rows="3" placeholder="Describe brevemente lo ocurrido (m√°x. 300 caracteres)" maxlength="300"></textarea>

    <div class="actions">
      <button type="button" id="btnUbic">üìç Obtener ubicaci√≥n</button>
      <span id="gpsStatus" class="badge">GPS: sin capturar</span>
    </div>

    <div class="row" aria-live="polite">
      <div>
        <label for="lat" id="lbl_lat">Latitud (auto)</label>
        <input id="lat" name="lat" placeholder="Latitud" readonly inputmode="numeric">
      </div>
      <div>
        <label for="lng" id="lbl_lng">Longitud (auto)</label>
        <input id="lng" name="lng" placeholder="Longitud" readonly inputmode="numeric">
      </div>
    </div>

    <a id="mapaLink" class="maplink muted" href="#" target="_blank" rel="noopener" hidden>Ver ubicaci√≥n en Google Maps ‚Üó</a>

    <div class="actions">
      <button type="submit" id="btnEnviar">Enviar</button>
      <button type="reset" class="ghost" id="btnLimpiar">Limpiar</button>
    </div>

    <p id="msg" role="status" aria-live="polite"></p>
    <input type="hidden" id="requestId">
    <input type="hidden" id="timestamp">
    <input type="hidden" id="mapaUrl">
  </form>

  <p class="footer" id="t_footer">Si el formulario falla, llama al <strong>+595 973 500767</strong> o escribe por WhatsApp haciendo <strong>clic aqu√≠</strong>.</p>

  <!-- Barra de √≠conos sociales -->
  <div class="social" aria-label="Redes sociales">
    <!-- Instagram -->
    <a href="https://www.instagram.com/tapeporapy/?hl=es" target="_blank" rel="noopener" aria-label="Instagram">
      <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 3.5A5.5 5.5 0 1 1 6.5 13 5.5 5.5 0 0 1 12 7.5zm0 2A3.5 3.5 0 1 0 15.5 13 3.5 3.5 0 0 0 12 9.5zM17.8 6.2a1 1 0 1 1-1.6 1.2 1 1 0 0 1 1.6-1.2z"/>
      </svg>
    </a>
    <!-- Facebook -->
    <a href="https://www.facebook.com/tapepora/?locale=es_LA" target="_blank" rel="noopener" aria-label="Facebook">
      <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M22 12a10 10 0 1 0-11.6 9.9v-7H7.9V12h2.5V9.8c0-2.5 1.5-3.9 3.7-3.9 1.1 0 2.2.2 2.2.2v2.4h-1.2c-1.2 0-1.6.8-1.6 1.5V12h2.8l-.45 2.9h-2.35v7A10 10 0 0 0 22 12z"/>
      </svg>
    </a>
    <!-- WhatsApp -->
    <a href="https://api.whatsapp.com/send?phone=595973500767&text=%C2%A1Hola!%20Escribo%20para%20solicitar%20asistencia%20%F0%9F%86%98" target="_blank" rel="noopener" aria-label="WhatsApp">
      <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M.057 24l1.687-6.163A11.867 11.867 0 0 1 0 11.993C0 5.372 5.373 0 11.994 0 18.616 0 24 5.372 24 11.993c0 6.622-5.384 11.995-12.006 11.995-2.043 0-4.042-.513-5.824-1.487L.057 24zm6.597-3.807c1.676.995 3.276 1.591 5.35 1.591 5.45 0 9.89-4.437 9.89-9.89 0-5.45-4.44-9.887-9.89-9.887-5.452 0-9.89 4.437-9.89 9.888 0 2.114.69 4.083 1.852 5.69l-.79 2.89 3.478-.972zM17.53 14.47c-.074-.123-.27-.198-.563-.347-.295-.148-1.748-.861-2.019-.959-.27-.099-.467-.148-.663.148-.197.296-.761.959-.934 1.155-.172.198-.344.223-.637.074-.295-.148-1.243-.458-2.366-1.46-.875-.78-1.467-1.742-1.64-2.038-.172-.296-.018-.456.13-.604.133-.132.296-.344.444-.516.148-.172.197-.296.296-.494.099-.197.05-.371-.025-.52-.074-.148-.663-1.598-.909-2.186-.24-.58-.484-.5-.663-.51l-.566-.01c-.197 0-.52.074-.792.371-.27.296-1.04 1.017-1.04 2.479s1.065 2.876 1.213 3.074c.148.197 2.095 3.2 5.076 4.487.71.306 1.263.489 1.694.626.712.227 1.36.195 1.872.118.571-.085 1.748-.713 1.995-1.402.246-.69.246-1.282.172-1.402z"/>
      </svg>
    </a>
  </div>

  <!-- Aviso legal (multiling√ºe) -->
  <p id="legal" class="legal"></p>

  <script>
  // === CONFIG ===
  const endpoint = "https://default688a0fce5571499b9b5a8fef12ae5c.08.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/540a67fb821042ce9a9c009ac064975c/triggers/manual/paths/invoke/?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=b3_sZEJJEMWiK_myP_QktIK34z9U2pcPjhTJX0GukK8";
  const FETCH_TIMEOUT_MS = 12000;
  const GPS_TIMEOUT_MS = 10000;
  const GPS_MAX_AGE_MS = 15000;

  // === I18N DICTIONARY ===
  const I18N = {
    es: {
      title: "Reportar evento SOS",
      intro: "Comparte tu ubicaci√≥n para enviar ayuda m√°s r√°pido. Tus datos se usar√°n solo para gestionar este reporte.",
      formHint: "Todos los campos marcados con * son obligatorios.",
      nombre: "Nombre",
      telefono: "Tel√©fono",
      telHint: "Escribe solo el n√∫mero local (sin 0, sin +). Se marcar√° como",
      tipo: "Tipo de evento",
      tipo_opts: { blank:"Selecciona‚Ä¶", Accidente:"Accidente", Mecanico:"Problema mec√°nico", Otro:"Otro" },
      heridos: "¬øHay heridos?",
      heridos_opts: { blank:"Selecciona‚Ä¶", si:"S√≠", no:"No" },
      detalle: "Detalle (opcional)",
      detalle_ph: "Describe brevemente lo ocurrido (m√°x. 300 caracteres)",
      btnUbic: "üìç Obtener ubicaci√≥n",
      gpsInit: "GPS: sin capturar",
      gpsBusy: "GPS: buscando‚Ä¶",
      gpsOk: acc => `GPS: OK (¬±${acc} m)`,
      gpsErr: "No se pudo obtener tu ubicaci√≥n. Puedes reintentar o enviar sin ubicaci√≥n.",
      lat: "Latitud (auto)",
      lng: "Longitud (auto)",
      mapText: "Ver ubicaci√≥n en Google Maps ‚Üó",
      enviar: "Enviar",
      limpiar: "Limpiar",
      sending: "Enviando‚Ä¶",
      msgOk: "¬°Reporte enviado correctamente! La ayuda va en camino.",
      msgPrep: "Preparando env√≠o‚Ä¶",
      msgTipoReq: "Selecciona el tipo de evento.",
      msgHeridosReq: "Indica si hay heridos.",
      msgTelReq: "Ingresa un n√∫mero local v√°lido (6 a 11 d√≠gitos).",
      ubicOk: "Ubicaci√≥n capturada correctamente.",
      ubicNoGeo: "Tu navegador no permite geolocalizaci√≥n.",
      footer: 'Si el formulario falla, llama al <strong>+595 973 500767</strong> o escribe por WhatsApp haciendo <a href="https://api.whatsapp.com/send?phone=595973500767&text=%C2%A1Hola!%20Escribo%20para%20solicitar%20asistencia%20%F0%9F%86%98" target="_blank" rel="noopener"><strong>clic aqu√≠</strong></a>.',
      legal: "Al enviar este reporte, autorizo a Tape Pora S.A. a recopilar y tratar mis datos personales y mi ubicaci√≥n para gestionar el incidente, coordinar la asistencia y contactarme, conforme a su Pol√≠tica de Privacidad.",
      name_ph: "Tu nombre",
      phone_preview_prefix: ""
    },
    en: {
      title: "Report SOS Event",
      intro: "Share your location to send help faster. Your data is used only to manage this report.",
      formHint: "All fields marked with * are required.",
      nombre: "Name",
      telefono: "Phone",
      telHint: "Type only the local number (no 0, no +). It will be formatted as",
      tipo: "Event type",
      tipo_opts: { blank:"Select‚Ä¶", Accidente:"Accident", Mecanico:"Mechanical issue", Otro:"Other" },
      heridos: "Are there injuries?",
      heridos_opts: { blank:"Select‚Ä¶", si:"Yes", no:"No" },
      detalle: "Details (optional)",
      detalle_ph: "Briefly describe what happened (max 300 characters)",
      btnUbic: "üìç Get location",
      gpsInit: "GPS: not captured",
      gpsBusy: "GPS: locating‚Ä¶",
      gpsOk: acc => `GPS: OK (¬±${acc} m)`,
      gpsErr: "Could not get your location. You can retry or submit without it.",
      lat: "Latitude (auto)",
      lng: "Longitude (auto)",
      mapText: "Open in Google Maps ‚Üó",
      enviar: "Submit",
      limpiar: "Clear",
      sending: "Sending‚Ä¶",
      msgOk: "Report sent successfully! Help is on the way.",
      msgPrep: "Preparing submission‚Ä¶",
      msgTipoReq: "Select the event type.",
      msgHeridosReq: "Please indicate if there are injuries.",
      msgTelReq: "Enter a valid local number (6 to 11 digits).",
      ubicOk: "Location captured successfully.",
      ubicNoGeo: "Your browser does not allow geolocation.",
      footer: 'If the form fails, call <strong>+595 973 500767</strong> or send a WhatsApp message: <a href="https://api.whatsapp.com/send?phone=595973500767&text=%C2%A1Hola!%20Escribo%20para%20solicitar%20asistencia%20%F0%9F%86%98" target="_blank" rel="noopener"><strong>Click here</strong></a>.',
      legal: "By submitting this report, I authorize Tape Pora S.A. to collect and process my personal data and location to manage the incident, coordinate assistance, and contact me, in accordance with its Privacy Policy.",
      name_ph: "Your name",
      phone_preview_prefix: ""
    },
    pt: {
      title: "Reportar ocorr√™ncia SOS",
      intro: "Compartilhe sua localiza√ß√£o para enviar ajuda mais r√°pido. Seus dados ser√£o usados apenas para este reporte.",
      formHint: "Todos os campos marcados com * s√£o obrigat√≥rios.",
      nombre: "Nome",
      telefono: "Telefone",
      telHint: "Digite apenas o n√∫mero local (sem 0, sem +). Ser√° formatado como",
      tipo: "Tipo de ocorr√™ncia",
      tipo_opts: { blank:"Selecione‚Ä¶", Accidente:"Acidente", Mecanico:"Problema mec√¢nico", Otro:"Outro" },
      heridos: "H√° feridos?",
      heridos_opts: { blank:"Selecione‚Ä¶", si:"Sim", no:"N√£o" },
      detalle: "Detalhe (opcional)",
      detalle_ph: "Descreva brevemente o ocorrido (m√°x. 300 caracteres)",
      btnUbic: "üìç Obter localiza√ß√£o",
      gpsInit: "GPS: n√£o capturado",
      gpsBusy: "GPS: buscando‚Ä¶",
      gpsOk: acc => `GPS: OK (¬±${acc} m)`,
      gpsErr: "N√£o foi poss√≠vel obter sua localiza√ß√£o. Tente novamente ou envie sem localiza√ß√£o.",
      lat: "Latitude (auto)",
      lng: "Longitude (auto)",
      mapText: "Ver no Google Maps ‚Üó",
      enviar: "Enviar",
      limpiar: "Limpar",
      sending: "Enviando‚Ä¶",
      msgOk: "Reporte enviado com sucesso! A ajuda est√° a caminho.",
      msgPrep: "Preparando envio‚Ä¶",
      msgTipoReq: "Selecione o tipo de ocorr√™ncia.",
      msgHeridosReq: "Informe se h√° feridos.",
      msgTelReq: "Digite um n√∫mero local v√°lido (6 a 11 d√≠gitos).",
      ubicOk: "Localiza√ß√£o capturada com sucesso.",
      ubicNoGeo: "Seu navegador n√£o permite geolocaliza√ß√£o.",
      footer: 'Se o formul√°rio falhar, ligue para <strong>+595 973 500767</strong> ou envie uma mensagem no WhatsApp <a href="https://api.whatsapp.com/send?phone=595973500767&text=%C2%A1Hola!%20Escribo%20para%20solicitar%20asistencia%20%F0%9F%86%98" target="_blank" rel="noopener"><strong>clicando aqui</strong></a>.',
      legal: "Ao enviar este reporte, autorizo a Tape Pora S.A. a coletar e tratar meus dados pessoais e minha localiza√ß√£o para gerenciar o incidente, coordenar a assist√™ncia e entrar em contato comigo, conforme sua Pol√≠tica de Privacidade.",
      name_ph: "Seu nome",
      phone_preview_prefix: ""
    },
    gn: {
      title: "Emombe‚Äôu peteƒ© mba‚Äôe oiko va‚Äôekue (SOS)",
      intro: "Emoheraku√£ ne renda ojejapo pya‚Äôe hagÃÉua pytyv√µ. Eipuruh√≠na ko marandu pe reporte a√±oite guar√£.",
      formHint: "Umi tenda ijuruj√°va * rehegua oikotev·∫Ω.",
      nombre: "T√©ra",
      telefono: "Pumbyry",
      telHint: "Ehai a√±oite pe papapy renda rehegua (ani 0, ani +). O√±emoha‚Äô√£nga ko‚Äô√£ichante",
      tipo: "Mba‚Äôe oiko va‚Äôekue",
      tipo_opts: { blank:"Eiporavo‚Ä¶", Accidente:"Jekaa", Mecanico:"Apopyre jejavy", Otro:"Ambue" },
      heridos: "¬øI√±apytyv√µr√£pa oƒ© (o√±embyai va‚Äôekue)?",
      heridos_opts: { blank:"Eiporavo‚Ä¶", si:"H√©·∫Ω", no:"Nah√°niri" },
      detalle: "Mba‚Äôemimi (jepy‚Äôapeteƒ©)",
      detalle_ph: "Emombe‚Äôu mbykymi mba‚Äôe oiko va‚Äôekue (hetav√©vo 300 tai)",
      btnUbic: "üìç Erek√≥ta ne renda",
      gpsInit: "GPS: ndaip√≥ri gueteri",
      gpsBusy: "GPS: oheka‚Ä¶",
      gpsOk: acc => `GPS: oƒ© por√£ (¬±${acc} m)`,
      gpsErr: "Ndaikat√∫i ojuhu ne renda. Ikatu eha‚Äô√£ jey t√©r√£ emondo rendaha‚Äô·ªπre.",
      lat: "Latitud (auto)",
      lng: "Longitud (auto)",
      mapText: "Hecha Google Maps-pe ‚Üó",
      enviar: "Emondo",
      limpiar: "Mopotƒ©",
      sending: "O√±emondo‚Ä¶",
      msgOk: "Reporte o√±emond√≥ma por√£! O√∫tama pytyv√µ.",
      msgPrep: "O√±embosako‚Äôi √±emondo‚Ä¶",
      msgTipoReq: "Eiporavo mba‚Äôe oiko va‚Äôekue.",
      msgHeridosReq: "Emombe‚Äôu oƒ©pa o√±embyai va‚Äôekue.",
      msgTelReq: "Ehai papapy renda hekopete (6 guive 11 papapy peve).",
      ubicOk: "Renda ojepyta peteƒ©chapa.",
      ubicNoGeo: "Ne kundah√°ra ndohej√°iri geolocalizaci√≥n.",
      footer: 'Ndohupytyrir√µ pe kuatia√±e‚Äô·∫Ω, ehen√≥i <strong>+595 973 500767</strong>-pe t√©r√£ emondo WhatsApp <a href="https://api.whatsapp.com/send?phone=595973500767&text=%C2%A1Hola!%20Escribo%20para%20solicitar%20asistencia%20%F0%9F%86%98" target="_blank" rel="noopener"><strong>clic √°pe</strong></a>.',
      legal: "Ko reporte remond√≥vo, ame‚Äô·∫Ω Tape Pora S.A.-pe che mba‚Äôekuaar√£ ha che renda rapykueho jejapyhymi ha jejapo, ikatu hagÃÉua ombohape pe oiko va‚Äôekue, omombyta pytyv√µ ha o√±ekomunika chendive, he‚Äôih√°icha i√±e‚Äô·∫Ωme‚Äô·∫Ω √±emigua rehegua.",
      name_ph: "Nde r√©ra",
      phone_preview_prefix: ""
    },
    de: {
      title: "SOS-Ereignis melden",
      intro: "Teile deinen Standort, damit Hilfe schneller gesendet werden kann. Deine Daten werden nur zur Bearbeitung dieser Meldung verwendet.",
      formHint: "Alle mit * gekennzeichneten Felder sind Pflichtfelder.",
      nombre: "Name",
      telefono: "Telefon",
      telHint: "Nur die lokale Nummer eingeben (ohne 0, ohne +). Sie wird formatiert als",
      tipo: "Ereignistyp",
      tipo_opts: { blank:"Ausw√§hlen‚Ä¶", Accidente:"Unfall", Mecanico:"Technisches Problem", Otro:"Sonstiges" },
      heridos: "Gibt es Verletzte?",
      heridos_opts: { blank:"Ausw√§hlen‚Ä¶", si:"Ja", no:"Nein" },
      detalle: "Details (optional)",
      detalle_ph: "Beschreibe kurz, was passiert ist (max. 300 Zeichen)",
      btnUbic: "üìç Standort ermitteln",
      gpsInit: "GPS: nicht erfasst",
      gpsBusy: "GPS: wird ermittelt‚Ä¶",
      gpsOk: acc => `GPS: OK (¬±${acc} m)`,
      gpsErr: "Standort konnte nicht ermittelt werden. Erneut versuchen oder ohne senden.",
      lat: "Breite (auto)",
      lng: "L√§nge (auto)",
      mapText: "In Google Maps √∂ffnen ‚Üó",
      enviar: "Senden",
      limpiar: "Zur√ºcksetzen",
      sending: "Senden‚Ä¶",
      msgOk: "Meldung erfolgreich gesendet! Hilfe ist unterwegs.",
      msgPrep: "Sendevorgang wird vorbereitet‚Ä¶",
      msgTipoReq: "Bitte Ereignistyp w√§hlen.",
      msgHeridosReq: "Bitte angeben, ob es Verletzte gibt.",
      msgTelReq: "G√ºltige lokale Nummer eingeben (6‚Äì11 Ziffern).",
      ubicOk: "Standort erfolgreich erfasst.",
      ubicNoGeo: "Dein Browser erlaubt keine Geolokalisierung.",
      footer: 'Falls das Formular fehlschl√§gt, rufe <strong>+595 973 500767</strong> an oder schicke eine WhatsApp-Nachricht: <a href="https://api.whatsapp.com/send?phone=595973500767&text=%C2%A1Hola!%20Escribo%20para%20solicitar%20asistencia%20%F0%9F%86%98" target="_blank" rel="noopener"><strong>hier klicken</strong></a>.',
      legal: "Mit dem Absenden dieses Berichts erm√§chtige ich Tape Pora S.A., meine personenbezogenen Daten und meinen Standort zu erfassen und zu verarbeiten, um den Vorfall zu bearbeiten, Hilfe zu koordinieren und mich zu kontaktieren, gem√§√ü der Datenschutzrichtlinie.",
      name_ph: "Dein Name",
      phone_preview_prefix: ""
    }
  };

  // === HELPERS ===
  const $ = sel => document.querySelector(sel);
  const f = $('#f');
  const btnEnviar = $('#btnEnviar');
  const btnUbic = $('#btnUbic');
  const msg = $('#msg');
  const gpsStatus = $('#gpsStatus');
  const mapaLink = $('#mapaLink');
  const telInput = $('#telefono');
  const codeSelect = $('#codPais');
  const phonePreview = $('#phonePreview');
  const tipoSel = $('#tipo');
  const grupoHeridos = $('#grupoHeridos');
  const heridosSel = $('#heridos');
  const mapaUrlHidden = $('#mapaUrl');

  const HINTS = {
    '+595': '981 123 456',
    '+55': '11 91234 5678',
    '+54': '11 1234 5678',
    '+598': '92 123 456',
    '+591': '7 6123456'
  };

  // Estado de idioma
  let LANG = localStorage.getItem('lang') || 'es';

  function setMsg(text, kind=""){ msg.className = kind || "muted"; msg.innerHTML = text; }
  function setSendingState(s, tSend){
    btnEnviar.disabled = s; btnUbic.disabled = s;
    btnEnviar.innerHTML = s ? `<span class="spinner"></span> ${tSend}` : getT('enviar');
  }
  function uuid4(){ return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{const r=crypto.getRandomValues(new Uint8Array(1))[0]&15;const v=c==='x'?r:(r&0x3|0x8);return v.toString(16);}); }
  function getT(key){ const t = I18N[LANG]?.[key]; return (typeof t === 'string') ? t : ''; }

  function normalizePhone(local, cc){
    let n = (local||'').replace(/\D/g,'').replace(/^0+/, '');
    return cc + n;
  }

  function updatePhoneUI(){
    const cc = codeSelect.value;
    const example = HINTS[cc] || '981 123 456';
    if(!telInput.value) telInput.placeholder = example;
    const digits = telInput.value.replace(/\D/g,'').replace(/^0+/, '');
    const pretty = digits.replace(/(\d{3,4})(?=\d)/g,'$1 ').trim();
    $('#telHint').innerHTML = `${I18N[LANG].telHint} <code id="phonePreview">${cc} ${pretty || example}</code>.`;
  }

  // Campo condicional "¬øHay heridos?"
  function updateHeridos(){
    const esAccidente = (tipoSel.value === 'Accidente');
    grupoHeridos.hidden = !esAccidente;
    heridosSel.required = esAccidente;
    if(!esAccidente){ heridosSel.value = ''; }
  }

  // GEOLOCATION
  async function getLocation(){
    if(!('geolocation' in navigator)){ gpsStatus.textContent = I18N[LANG].gpsInit; setMsg(I18N[LANG].ubicNoGeo,'err'); return; }
    gpsStatus.textContent = I18N[LANG].gpsBusy; setMsg(I18N[LANG].gpsBusy,'muted');
    const opts = { enableHighAccuracy:true, timeout: GPS_TIMEOUT_MS, maximumAge: GPS_MAX_AGE_MS };
    const p = new Promise((resolve,reject)=>{ navigator.geolocation.getCurrentPosition(resolve,reject,opts); });
    try{
      const pos = await p;
      const { latitude, longitude, accuracy } = pos.coords;
      $('#lat').value = latitude.toFixed(6);
      $('#lng').value = longitude.toFixed(6);
      gpsStatus.textContent = I18N[LANG].gpsOk(Math.round(accuracy));
      updateMapLink($('#lat').value,$('#lng').value);
      setMsg(I18N[LANG].ubicOk,'ok');
    }catch{
      gpsStatus.textContent = I18N[LANG].gpsInit;
      setMsg(I18N[LANG].gpsErr,'err');
    }
  }

  function updateMapLink(lat,lng){
    if(lat && lng){
      const url = `https://www.google.com/maps?q=${lat},${lng}`;
      mapaLink.href = url;
      mapaLink.textContent = I18N[LANG].mapText;
      mapaLink.hidden = false;
      mapaLink.classList.remove('muted');
      mapaUrlHidden.value = url;
    }else{
      mapaLink.hidden = true;
      mapaUrlHidden.value = "";
    }
  }

  // === I18N APPLY ===
  function applyLang(){
    document.documentElement.setAttribute('lang', LANG);
    $('#t_title').textContent = I18N[LANG].title;
    $('#t_intro').textContent = I18N[LANG].intro;
    $('#formHint').textContent = I18N[LANG].formHint;
    $('#lbl_nombre').textContent = I18N[LANG].nombre;
    $('#lbl_tel').textContent = I18N[LANG].telefono;
    $('#lbl_tipo').textContent = I18N[LANG].tipo;
    $('#lbl_heridos').textContent = I18N[LANG].heridos;
    $('#lbl_detalle').textContent = I18N[LANG].detalle;
    $('#detalle').placeholder = I18N[LANG].detalle_ph;
    $('#btnUbic').textContent = I18N[LANG].btnUbic;
    gpsStatus.textContent = I18N[LANG].gpsInit;
    $('#lbl_lat').textContent = I18N[LANG].lat;
    $('#lbl_lng').textContent = I18N[LANG].lng;
    $('#mapaLink').textContent = I18N[LANG].mapText;
    btnEnviar.textContent = I18N[LANG].enviar;
    $('#btnLimpiar').textContent = I18N[LANG].limpiar;
    $('#t_footer').innerHTML = I18N[LANG].footer;
    $('#nombre').placeholder = I18N[LANG].name_ph;
    // Aviso legal
    const legalNode = document.getElementById('legal');
    if (legalNode && I18N[LANG].legal) legalNode.textContent = I18N[LANG].legal;

    // Opciones de selects (tipo)
    const optMap = I18N[LANG].tipo_opts;
    const selectedTipo = tipoSel.value || '';
    tipoSel.innerHTML = `
      <option value="">${optMap.blank}</option>
      <option value="Accidente">${optMap.Accidente}</option>
      <option value="Mecanico">${optMap.Mecanico}</option>
      <option value="Otro">${optMap.Otro}</option>
    `;
    tipoSel.value = selectedTipo;

    // Opciones heridos
    const hMap = I18N[LANG].heridos_opts;
    const selHeridos = heridosSel.value || '';
    heridosSel.innerHTML = `
      <option value="">${hMap.blank}</option>
      <option value="si">${hMap.si}</option>
      <option value="no">${hMap.no}</option>
    `;
    heridosSel.value = selHeridos;

    updatePhoneUI();
    updateMapLink($('#lat').value, $('#lng').value);

    document.querySelectorAll('.lang-btn').forEach(b=>{
      b.classList.toggle('active', b.dataset.lang === LANG);
    });
  }

  // === EVENTS ===
  document.querySelectorAll('.lang-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      LANG = btn.dataset.lang;
      localStorage.setItem('lang', LANG);
      applyLang();
    });
  });

  codeSelect.addEventListener('change', updatePhoneUI);
  telInput.addEventListener('input', updatePhoneUI);
  tipoSel.addEventListener('change', ()=>{ updateHeridos(); });

  $('#btnUbic').addEventListener('click', getLocation);

  window.addEventListener('load', ()=>{
    $('#requestId').value = uuid4();
    $('#timestamp').value = new Date().toISOString();
    applyLang();
    updateHeridos();
    getLocation();
  });

  // SUBMIT
  f.addEventListener('submit', async e=>{
    e.preventDefault();

    const localDigits = telInput.value.replace(/\D/g,'');
    if(!tipoSel.value){ setMsg(I18N[LANG].msgTipoReq,'err'); tipoSel.focus(); return; }
    if(tipoSel.value === 'Accidente' && !heridosSel.value){
      setMsg(I18N[LANG].msgHeridosReq,'err'); heridosSel.focus(); return;
    }
    if(!localDigits || !/^\d{6,11}$/.test(localDigits)){
      setMsg(I18N[LANG].msgTelReq,'err'); telInput.focus(); return;
    }

    setSendingState(true, I18N[LANG].sending);
    setMsg(I18N[LANG].msgPrep,'muted');

    const cc = codeSelect.value;
    const telefonoIntl = normalizePhone(localDigits, cc);

    const latV = $('#lat').value ? parseFloat($('#lat').value) : null;
    const lngV = $('#lng').value ? parseFloat($('#lng').value) : null;

    const payload = {
      requestId: $('#requestId').value || uuid4(),
      timestamp: new Date().toISOString(),
      nombre: $('#nombre').value.trim() || null,
      telefono: telefonoIntl,
      telefonoLocal: localDigits,
      codigoPais: cc,
      tipoEvento: tipoSel.value,
      HayHeridosTexto: heridosSel.value ? (heridosSel.value === 'si' ? I18N[LANG].heridos_opts.si : I18N[LANG].heridos_opts.no) : null,
      HayHeridosTextoEs: heridosSel.value ? (heridosSel.value === 'si' ? I18N.es.heridos_opts.si : I18N.es.heridos_opts.no) : null,
      HayHeridos: heridosSel.value ? (heridosSel.value === 'si') : null,
      detalle: $('#detalle').value.trim() || "",
      lat: latV,
      lng: lngV,
      mapaUrl: $('#mapaUrl').value || "",
      uiLang: LANG,
      userAgent: navigator.userAgent,
      online: navigator.onLine
    };

    const controller = new AbortController();
    const to = setTimeout(()=>controller.abort(), FETCH_TIMEOUT_MS);

    try{
      const res = await fetch(endpoint, {
        method:"POST",
        headers:{ "Content-Type":"application/json", "X-Request-Id": payload.requestId },
        body: JSON.stringify(payload),
        signal: controller.signal
      });
      clearTimeout(to);
      if(!res.ok){ const t = await res.text().catch(()=> ''); throw new Error(`HTTP ${res.status}: ${t||'sin detalle'}`); }
      setMsg(I18N[LANG].msgOk,'ok');
      setSendingState(false, I18N[LANG].sending);
      f.reset();
      $('#requestId').value = uuid4();
      $('#timestamp').value = new Date().toISOString();
      gpsStatus.textContent = I18N[LANG].gpsInit;
      updateMapLink(null,null);
      updatePhoneUI();
      updateHeridos();
    }catch(err){
      clearTimeout(to);
      console.error(err);
      setSendingState(false, I18N[LANG].sending);
      setMsg("No se pudo enviar. Verifica tu conexi√≥n y reintenta. / Could not send. Check your connection and try again.",'err');
    }
  });

  // Limpieza
  $('#btnLimpiar').addEventListener('click', ()=>{
    setMsg('', 'muted');
    gpsStatus.textContent = I18N[LANG].gpsInit;
    updateMapLink(null,null);
    updatePhoneUI();
    updateHeridos();
  });
  </script>
</body>
</html>
