<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Reporte SOS</title>
  <style>
    body{font-family:system-ui;max-width:600px;margin:20px auto;padding:0 12px}
    label{display:block;margin:8px 0 4px}
    input,select,button{width:100%;padding:10px;margin-bottom:10px}
    #msg{margin-top:15px;font-weight:bold}
  </style>
</head>
<body>
  <h2>Reportar evento SOS</h2>
  <form id="f">
    <label>Nombre</label>
    <input id="nombre" placeholder="Tu nombre">

    <label>Teléfono</label>
    <input id="telefono" type="tel" placeholder="+595..." required>

    <label>Tipo de evento</label>
    <select id="tipo" required>
      <option value="">Selecciona…</option>
      <option>Accidente</option>
      <option>Falla de auto</option>
      <option>Arrollamiento</option>
    </select>

    <label>Ubicación (automática)</label>
    <input id="lat" placeholder="Latitud" readonly>
    <input id="lng" placeholder="Longitud" readonly>

    <button type="submit">Enviar</button>
  </form>

  <p id="msg"></p>

  <script>
    const endpoint = "PEGAR_AQUI_URL_DEL_FLOW_DE_POWER_AUTOMATE";

    // Capturar ubicación
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(pos){
        document.getElementById('lat').value = pos.coords.latitude.toFixed(6);
        document.getElementById('lng').value = pos.coords.longitude.toFixed(6);
      });
    }

    // Enviar datos
    document.getElementById('f').addEventListener('submit', async e=>{
      e.preventDefault();
      msg.textContent = "Enviando...";
      const payload = {
        nombre: nombre.value.trim(),
        telefono: telefono.value.trim(),
        tipoEvento: tipo.value,
        lat: parseFloat(lat.value || 0),
        lng: parseFloat(lng.value || 0)
      };
      try{
        const res = await fetch(endpoint, {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });
        if(!res.ok) throw new Error("Error HTTP "+res.status);
        msg.textContent = "¡Reporte enviado correctamente! La ayuda va en camino.";
        f.reset(); lat.value=""; lng.value="";
      }catch(err){
        msg.textContent = "No se pudo enviar. Intente nuevamente.";
      }
    });
  </script>
</body>
</html>
